<div class="page-break"></div>

<section class="ird-page">
    <div class="ird-container">
        <h2 class="section-title-center">Índice de Riesgo Digital</h2>

        <!-- Updated to IRD Box (Rounded Rectangle) -->
        <!-- 'final-score' attribute holds the value for JS animation. Content is pre-filled for PDF static render. -->
        <div class="ird-box {{ ird.level_class }}" id="irdBox">
            <span class="ird-score" id="irdScore" data-target="{{ ird.score }}">{{ ird.score }}</span>
            <span class="ird-label {{ ird.level_class }}">{{ ird.level }}</span>
        </div>


    </div>
</section>

<!-- Progressive Animation Script (Browser Only - Ignored by PDF Renderer) -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Only run if elements exist
        const scoreEl = document.getElementById('irdScore');
        const boxEl = document.getElementById('irdBox');
        const labelEl = boxEl ? boxEl.querySelector('.ird-label') : null;

        if (!scoreEl || !boxEl || !labelEl) return;

        const targetScore = parseInt(scoreEl.getAttribute('data-target'), 10);
        if (isNaN(targetScore)) return;

        // Animation Config
        const duration = 4000; // 4 seconds
        const startTimestamp = performance.now();

        // Strict Range Logic (0-19, 20-39, 40-59, 60-79, 80-100)
        // Colors: Low=Blue, Med=Yellow, High=Orange (#ff9f43), Crit=Red, Max=Purple
        function getRiskData(s) {
            if (s >= 80) return { color: '#a29bfe', text: 'RIESGO MÁXIMO', glow: 'rgba(162, 155, 254, 0.2)' };
            if (s >= 60) return { color: '#ff7675', text: 'RIESGO CRÍTICO', glow: 'rgba(255, 118, 117, 0.2)' };
            if (s >= 40) return { color: '#ff9f43', text: 'RIESGO ALTO', glow: 'rgba(255, 159, 67, 0.2)' }; // Orange
            if (s >= 20) return { color: '#ffeaa7', text: 'RIESGO MODERADO', glow: 'rgba(255, 234, 167, 0.2)' };
            return { color: '#74b9ff', text: 'RIESGO BAJO', glow: 'rgba(116, 185, 255, 0.2)' };
        }

        function step(timestamp) {
            const progress = Math.min((timestamp - startTimestamp) / duration, 1);
            const currentScore = Math.floor(progress * targetScore);

            // Get Dynamic Data
            const riskData = getRiskData(currentScore);

            // Update Content
            scoreEl.innerText = currentScore;
            labelEl.innerText = riskData.text;

            // Update Styles (Dynamic Color & Glow)
            scoreEl.style.color = riskData.color;
            // Label can inherit or be explicit. Let's be explicit to ensure sync.
            // boxEl.style.borderColor = riskData.color; 
            // Note: CSS might override if specific classes are present, but inline styles normally win.

            boxEl.style.borderColor = riskData.color;
            boxEl.style.boxShadow = `0 0 20px ${riskData.glow}`;
            // Optional: Subtle background tint
            boxEl.style.backgroundColor = riskData.glow.replace('0.2', '0.05');

            if (progress < 1) {
                window.requestAnimationFrame(step);
            } else {
                // Final State (Ensure exact match)
                scoreEl.innerText = targetScore;
                const finalData = getRiskData(targetScore);

                labelEl.innerText = finalData.text;
                scoreEl.style.color = finalData.color;
                boxEl.style.borderColor = finalData.color;
                boxEl.style.boxShadow = `0 0 20px ${finalData.glow}`;
                boxEl.style.backgroundColor = finalData.glow.replace('0.2', '0.05');
            }
        }

        // Start Animation
        window.requestAnimationFrame(step);
    });
</script>
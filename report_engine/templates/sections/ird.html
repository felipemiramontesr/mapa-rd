<section class="ird-page report-section">
    <div class="ird-container">
        <h2 class="section-title-center">Índice de Riesgo Digital</h2>

        <!-- Updated to IRD Box (Rounded Rectangle) -->
        <!-- 'final-score' attribute holds the value for JS animation. Content is pre-filled for PDF static render. -->
        <div class="ird-box {{ ird.level_class }}" id="irdBox">
            <span class="ird-score" id="irdScore" data-target="{{ ird.score }}">{{ ird.score }}</span>
            <span class="ird-label {{ ird.level_class }}">{{ ird.level }}</span>
        </div>

        <!-- Interpretation Card (Matches Vectors Description Style) -->
        <div class="description-card"
            style="margin-top: 3rem; text-align: left; background: var(--bg-card); padding: 2rem; border-radius: 4px; border: 1px solid var(--border-color);">
            <h4 class="sub-header-simple">Interpretación de Riesgo</h4>
            <div class="description-text">
                {% if ird.score >= 80 %}
                <p><strong>Urgencia Inmediata:</strong> Un IRD de {{ ird.score }} señala un MÁXIMO riesgo sistémico.
                    Datos
                    sensibles (financieros/accesos) están expuestos activamente. Se requiere <strong>contención de
                        emergencia</strong> para evitar fraude inminente.</p>
                {% elif ird.score >= 60 %}
                <p><strong>Estado Crítico:</strong> Un IRD de {{ ird.score }} indica una postura de riesgo activo.
                    Credenciales o datos privados están expuestos, con probabilidad elevada de impacto operativo o
                    regulatorio si no se actúa en el corto plazo.</p>
                {% elif ird.score >= 40 %}
                <p><strong>Riesgo Alto:</strong> Múltiples vectores de ataque están abiertos. Aunque la operación
                    continúa,
                    la superficie de exposición es inaceptable y requiere corrección prioritaria.</p>
                {% elif ird.score >= 20 %}
                <p><strong>Atención Requerida:</strong> Exposición moderada detectada. Existen brechas específicas que
                    deben
                    cerrarse programadamente para evitar una escalada de riesgo.</p>
                {% else %}
                <p><strong>Postura Robusta:</strong> El entorno digital se encuentra bajo control. Mantenga la
                    vigilancia y
                    los controles actuales para preservar este nivel de seguridad.</p>
                {% endif %}
            </div>
        </div>


    </div>
</section>

<!-- Progressive Animation Script (Browser Only - Ignored by PDF Renderer) -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const scoreEl = document.getElementById('irdScore');
        const boxEl = document.getElementById('irdBox');
        const labelEl = boxEl ? boxEl.querySelector('.ird-label') : null;

        if (!scoreEl || !boxEl || !labelEl) return;

        const targetScore = parseInt(scoreEl.getAttribute('data-target'), 10);
        if (isNaN(targetScore)) return;

        const duration = 4000;
        const startTimestamp = performance.now();

        // Map scores to CSS variables (defined in tokens.css)
        function getRiskConfig(s) {
            if (s >= 80) return { var: '--risk-max', text: 'RIESGO MÁXIMO' };
            if (s >= 60) return { var: '--risk-crit', text: 'RIESGO CRÍTICO' };
            if (s >= 40) return { var: '--risk-high', text: 'RIESGO ALTO' };
            if (s >= 20) return { var: '--risk-med', text: 'RIESGO MEDIO' };
            return { var: '--risk-low', text: 'RIESGO BAJO' };
        }

        // Helper to get computed color from variable
        function getColor(cssVar) {
            return getComputedStyle(document.documentElement).getPropertyValue(cssVar).trim();
        }

        function step(timestamp) {
            const progress = Math.min((timestamp - startTimestamp) / duration, 1);
            const currentScore = Math.floor(progress * targetScore);

            const config = getRiskConfig(currentScore);
            const color = getColor(config.var);

            // Text Updates
            scoreEl.innerText = currentScore;
            labelEl.innerText = config.text;

            // Style Updates
            scoreEl.style.color = color;
            labelEl.style.color = color;
            boxEl.style.borderColor = color;
            // Simple glow effect using the color with opacity
            boxEl.style.boxShadow = `0 0 20px ${color}33`;
            boxEl.style.backgroundColor = `${color}0D`;

            if (progress < 1) {
                window.requestAnimationFrame(step);
            } else {
                // Final state exact match
                scoreEl.innerText = targetScore;
                const finalConfig = getRiskConfig(targetScore);
                const finalColor = getColor(finalConfig.var);

                labelEl.innerText = finalConfig.text;
                labelEl.style.color = finalColor;
                scoreEl.style.color = finalColor;
                boxEl.style.borderColor = finalColor;
                boxEl.style.boxShadow = `0 0 20px ${finalColor}33`;
                boxEl.style.backgroundColor = `${finalColor}0D`;
            }
        }

        window.requestAnimationFrame(step);
    });
</script>